// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public", "auth"]
}

enum Rol {
  ADMIN
  USUARIO

  @@schema("public")
}

enum Estatus {
  ACTIVO
  USADO
  DESTRUIDO

  @@schema("public")
}

model Categoria {
  id          Int        @id @default(autoincrement())
  nombre      String
  acronimo    String     @unique
  descripcion String?
  productos   Producto[]

  @@schema("public")
}

model Equipo {
  id          Int     @id @default(autoincrement())
  nombre      String
  descripcion String?
  usuarios    users[]

  fechaRegistro      DateTime @default(now())
  fechaActualizacion DateTime @updatedAt

  @@schema("public")
}

model users {
  id        Int        @id @default(autoincrement())
  name      String
  email     String     @unique
  rol       Rol        @default(USUARIO)
  equipos   Equipo[]
  productos Producto[]

  fechaRegistro      DateTime @default(now())
  fechaActualizacion DateTime @updatedAt

  @@schema("auth")
}

model Qr {
  id         Int      @id @default(autoincrement())
  codigo     String   @unique
  estatus    Estatus  @default(ACTIVO)
  producto   Producto @relation(fields: [productoId], references: [id], onDelete: Cascade)
  productoId Int      @unique

  fechaRegistro      DateTime @default(now())
  fechaActualizacion DateTime @updatedAt

  @@schema("public")
}

model Producto {
  id             Int       @id @default(autoincrement())
  nombre         String
  descripcion    String
  categoria      String
  cepa           String
  thc            Float
  cbd            Float
  imagen         String[]
  aroma          String
  efecto         String
  fabricante     String
  pais           String
  proveedor      String
  precio         Float?
  peso           Float?
  fechaCosecha   DateTime?
  fechaEnvasado  DateTime?
  fechaCaducidad DateTime?
  lote           String?
  certificado    String?
  notas          String?
  qr             Qr?
  usuarioEmail   String

  usuario_   users     @relation(fields: [usuarioEmail], references: [email], onDelete: Cascade)
  categoria_ Categoria @relation(fields: [categoria], references: [acronimo], onDelete: Cascade)

  fechaRegistro      DateTime @default(now())
  fechaActualizacion DateTime @updatedAt

  @@schema("public")
}
